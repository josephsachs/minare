#!/bin/bash

docker exec -it mongodb mongosh --quiet --eval "var allSnapshots = []; db.getSiblingDB('node_graph').getCollectionNames().filter(c => c.startsWith('snapshot_')).forEach(c => { var meta = db.getSiblingDB('node_graph')[c].findOne({_id: 'metadata'}); if(meta) { allSnapshots.push({collection: c, createdAt: meta.createdAt.toNumber()}); } }); allSnapshots.sort((a,b) => a.createdAt - b.createdAt).forEach(s => { print('\\n=== ' + s.collection + ' (' + new Date(s.createdAt) + ') ==='); db.getSiblingDB('node_graph')[s.collection].find().forEach(printjson); });"